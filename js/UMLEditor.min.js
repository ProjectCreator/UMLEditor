(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n=function(t,e){function n(){this.constructor=t}for(var a in e)s.call(e,a)&&(t[a]=e[a]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;window.App={Connections:{},Templates:{}},String.prototype._idSafe=function(){return this.replace(/([\u0080-\uffff]|\s+)/g,"_")},String.prototype._idUnique=function(){var t,e,n;for(e=this,n=e,t=0;document.getElementById(n);)n=e+"-"+t++;return""+n},String.prototype._capitalize=function(){return this[0].toUpperCase()+this.slice(1)},String.prototype.contains=function(t){return this.indexOf(t)>=0},Array.prototype.without=function(t){var e;return function(){var n,s,a;for(a=[],n=0,s=this.length;s>n;n++)e=this[n],e!==t&&a.push(e);return a}.call(this)},Array.prototype.remove=function(t){var e;return e=this.indexOf(t),e>=0&&this.splice(e,1),this},Object.defineProperties(Array.prototype,{first:{get:function(){return this[0]},set:function(t){return this[0]=t,this}},second:{get:function(){return this[1]},set:function(t){return this[1]=t,this}},last:{get:function(){return this[this.length-1]},set:function(t){return this[this.length-1]=t,this}}}),App.Templates.navbar={template:'<nav class="navbar navbar-default">\n    <div class="container-fluid">\n        <div class="navbar-header">\n            <a class="navbar-brand" href="#">UMLEditor</a>\n        </div>\n\n        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n            <ul class="nav navbar-nav">\n                <li>\n                    <a href="#">\n                        <span class="label label-primary label-lg newClass">\n                            New class &nbsp;\n                            <span class="glyphicon glyphicon-plus"></span>\n                        </span>\n                    </a>\n                </li>\n                <li>\n                    <a href="#">\n                        <span class="label label-primary label-lg newConnection">\n                            Connect classes &nbsp;\n                            <span class="glyphicon glyphicon-link"></span>\n                        </span>\n                    </a>\n                </li>\n                <li>\n                    <a href="#">\n                        <span class="label label-primary label-lg save">\n                            Save &nbsp;\n                            <span class="glyphicon glyphicon-hdd"></span>\n                        </span>\n                    </a>\n                </li>\n                <li class="dropdown">\n                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">\n                        Export &nbsp;\n                        <span class="glyphicon glyphicon-export"></span>\n                        {{!<span class="caret"></span>}}\n                    </a>\n                    <ul class="dropdown-menu export">\n                        <li class="json"><a href="#">JSON</a></li>\n                        <li class="cson"><a href="#">CSON</a></li>\n                        <li class="xml"><a href="#">XML</a></li>\n                    </ul>\n                </li>\n                <li class="dropdown">\n                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">\n                        Import &nbsp;\n                        <span class="glyphicon glyphicon-import"></span>\n                        {{!<span class="caret"></span>}}\n                    </a>\n                    <ul class="dropdown-menu imort">\n                        <li class="json"><a href="#">JSON</a></li>\n                        <li class="cson"><a href="#">CSON</a></li>\n                        <li class="xml"><a href="#">XML</a></li>\n                    </ul>\n                </li>\n            </ul>\n            <ul class="nav navbar-nav navbar-right">\n                <form class="navbar-form" role="search">\n                    <div class="form-group relative">\n                        <input type="text" class="form-control search" placeholder="Search classes">\n                        <button type="button" class="close" title="Clear search">\n                            <span>&times;</span>\n                        </button>\n                    </div>\n                </form>\n            </ul>\n        </div>\n    </div>\n</nav>',bindEvents:function(t){var e,n,s,a;return a=this.find(".search"),e=a.siblings(".close"),a.keyup(function(n){var s,i,r,o,l,c,p,d;if(27===n.which)return e.click(),!0;if(d=a.val(),(null!=d?d.length:void 0)>0?e.fadeIn(100):e.fadeOut(100),(null!=d?d.length:void 0)>2)for(t.svg.select(".background").classed("searching",!0),c=t.classes,i=0,o=c.length;o>i;i++)s=c[i],s.name.contains(d)||s.views["class"].element.classed("searching",!0);else for(t.svg.select(".background").classed("searching",!1),p=t.classes,r=0,l=p.length;l>r;r++)s=p[r],s.views["class"].element.classed("searching",!1);return!0}),e.click(function(){return a.val("").keyup(),!0}),this.find(".label.newClass").click(function(){var e;return e=new App.UMLClass(t,"_"+Date.now(),[],[]),t.addClass(e),t.draw(),!0}),this.find(".label.newConnection").click(function(){return t.showConnectionModal(),!0}),this.find(".label.save").click(function(){return!0}),n=this.find(".export"),n.find(".json").click(function(){return void 0}),s=this.find(".import"),s.find(".json").click(function(){return void 0}),this}},App.Templates.svg='<div class="svgWrapper">\n<svg class="uml">\n    <rect class="background" width="100%" height="100%"></rect>\n    <g class="zoomer"></g>\n</svg>\n</div>',App.Templates.chooseConnection={template:'<div class="modal fade uml chooseConnection">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">\n                    <span>&times;</span>\n                </button>\n                <h3 class="modal-title">\n                    Choose a connection / dependency type\n                </h3>\n            </div>\n            <div class="modal-body">\n                <div class="general">\n                    <form class="form-horizontal form-group">\n                        <h4>Class level relationships</h4>\n                        <div class="row padded">\n                            <div class="col-xs-8 col-xs-push-2">\n                                <div class="input-group clickable">\n                                    <span class="input-group-addon">\n                                        <input type="radio" name="connectionType" value="generalization" />\n                                    </span>\n                                    <input type="text" class="form-control no-focus" readonly value="Generalization (\'inherit from X\')" />\n                                </div>\n                            </div>\n                        </div>\n                        <div class="row padded">\n                            <div class="col-xs-8 col-xs-push-2">\n                                <div class="input-group clickable">\n                                    <span class="input-group-addon">\n                                        <input type="radio" name="connectionType" value="realization" />\n                                    </span>\n                                    <input type="text" class="form-control no-focus" readonly value="Realization (\'implement X\')" />\n                                </div>\n                            </div>\n                        </div>\n\n                        <h4>Instance level relationships</h4>\n                        <div class="row padded">\n                            <div class="col-xs-8 col-xs-push-2">\n                                <div class="input-group clickable">\n                                    <span class="input-group-addon">\n                                        <input type="radio" name="connectionType" value="association" />\n                                    </span>\n                                    <input type="text" class="form-control no-focus" readonly value="Association (\'has relationship to X\')" />\n                                </div>\n                            </div>\n                        </div>\n                        <div class="row padded">\n                            <div class="col-xs-8 col-xs-push-2">\n                                <div class="input-group clickable">\n                                    <span class="input-group-addon">\n                                        <input type="radio" name="connectionType" value="aggregation" />\n                                    </span>\n                                    <input type="text" class="form-control no-focus" readonly value="Aggregation (\'is part of X\')" />\n                                </div>\n                            </div>\n                        </div>\n                        <div class="row padded">\n                            <div class="col-xs-8 col-xs-push-2">\n                                <div class="input-group clickable">\n                                    <span class="input-group-addon">\n                                        <input type="radio" name="connectionType" value="composition" />\n                                    </span>\n                                    <input type="text" class="form-control no-focus" readonly value="Composition (\'is necessary part of X\')" />\n                                </div>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default cancel" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-primary save">Next (select classes)</button>\n            </div>\n        </div>\n    </div>\n</div>',bindEvents:function(t){var e,n,s;return s=this.find(".save"),e=this.find(".input-group"),e.click(function(){return $(this).find("input[type='radio']").prop("checked",!0),e.filter(".has-error").removeClass("has-error"),s.hasClass("btn-danger")&&s.removeClass("btn-danger"),!0}),n=this.find("[name='connectionType']"),s.click(function(){var a;return a=n.filter(":checked"),a.length>0?t.hideConnectionModal().showClassNamesOnly().dataCollector.reset().setType(a.val()).show():(e.eq(0).addClass("has-error"),s.addClass("btn-danger")),!0}),this}},App.Templates.selectClassesForConnection={template:'<div class="selectClassesForConnection">\n    <div class="alert alert-danger alert-sm">\n        <div class="row padded">\n            <div class="centered bigger">\n                <strong>STATUS</strong>\n            </div>\n        </div>\n        <div class="row padded">\n            <div class="col-xs-4">\n                <strong>type:</strong>\n                <span class="type"></span>\n            </div>\n            <div class="col-xs-4">\n                <strong>source:</strong>\n                <span class="source"></span>\n            </div>\n            <div class="col-xs-4">\n                <strong>target:</strong>\n                <span class="target"></span>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-xs-4 col-xs-push-4 centered">\n                <button class="btn btn-primary save" style="margin-right: 15px;">Save</button>\n                <button class="btn btn-danger cancel">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>',bindEvents:function(t){var e,n;return n=this.find(".save"),e=this.find(".cancel"),n.click(function(){var e;return e=t.dataCollector.hide().createConnection(),t.addConnection(e).draw(),!0}),e.click(function(){return t.showClassData().dataCollector.hide(),!0}),this}},App.Templates.editUMLClass={template:'<div class="modal fade uml edit">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">\n                    <span>&times;</span>\n                </button>\n                <h3 class="modal-title">\n                    <span>Edit "<span class="className">{{className}}</span>"</span>\n                    <button type="button" class="btn btn-danger deleteClass right hpadded">Delete class</button>\n                    <button type="button" class="btn btn-default renameClass right">Rename class</button>\n                </h3>\n            </div>\n            <div class="modal-body">\n                <div class="general">\n                    <h4>General options</h4>\n                    <form class="form-horizontal form-group">\n                        <div class="row">\n                            <div class="col-xs-4 col-xs-push-2">\n                                <div class="input-group">\n                                    <span class="input-group-addon">\n                                        <input type="checkbox" class="abstractCheckbox"{{isAbstract}} />\n                                    </span>\n                                    <input type="text" class="form-control" readonly value="is abstract?" />\n                                </div>\n                            </div>\n                            <div class="col-xs-4 col-xs-push-2">\n                                <div class="input-group">\n                                    <span class="input-group-addon">\n                                        <input type="checkbox" class="interfaceCheckbox"{{isInterface}} />\n                                    </span>\n                                    <input type="text" class="form-control" readonly value="is interface?" />\n                                </div>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <div class="attributes">\n                    <h4>Attributes</h4>\n                    <form class="form-horizontal"></form>\n                    <div class="row">\n                        <div class="col-xs-10 col-xs-push-2">\n                            <button type="button" class="btn btn-primary add">Add attribute</button>\n                        </div>\n                    </div>\n                </div>\n                <hr />\n                <div class="methods">\n                    <h4>Methods</h4>\n                    <form class="form-horizontal"></form>\n                    <div class="row">\n                        <div class="col-xs-10 col-xs-push-2">\n                            <button type="button" class="btn btn-primary add">Add method</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-danger cancel" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-default reset">Reset</button>\n                <button type="button" class="btn btn-primary btn-lg save">Save changes</button>\n            </div>\n        </div>\n    </div>\n</div>',bindEvents:function(t){var e;return e=this,this.find("button.deleteClass").click(function(){return confirm("Are you really sure you want to delete the class '"+t.model.name+"' and all of its incoming and outgoing dependencies?")&&(t.hide(),e.on("hidden.bs.modal",function(){return t.model.editor.removeClass(t.model),!0})),!0}),this.find("button.renameClass").click(function(){var e;return null!=(e=prompt("Enter the new name of the class!"))&&(t.model.name=e,t.draw()),!0}),this.find("button.cancel").click(function(){return t.draw(),!0}),this.find("button.reset").click(function(){return t.draw(),!0}),this.find("button.save").click(function(){var e;return e=t._getInput(),t.model.update(e.attributes,e.methods,e.generalOptions),t.hide(),!0}),this.find(".attributes .add").click(function(){return e.find(".attributes form").append(t._createFormRow({name:"new attribute",type:"new type",visibility:"public"},!0)),!0}),this.find(".methods .add").click(function(){return e.find(".methods form").append(t._createFormRow({name:"new method",type:"new type",visibility:"public"},!1)),!0}),this}},App.Templates.editUMLClassParamRow={template:'<div class="row padded parameter">\n    <div class="col-xs-3">\n        <input type="text" class="form-control name" placeholder="parameter name" value="{{name}}" />\n    </div>\n    <div class="col-xs-3">\n        <input type="text" class="form-control type" placeholder="parameter type" value="{{type}}" />\n    </div>\n    <div class="col-xs-2">\n        <input type="text" class="form-control default" placeholder="default" value="{{default}}" data-current-value="{{default}}" />\n    </div>\n    <div class="col-xs-3">\n        <div class="input-group">\n            <span class="input-group-addon">\n                <input type="checkbox" class="nullCheckbox" />\n            </span>\n            <input type="text" class="form-control" readonly value="NULL" />\n        </div>\n    </div>\n    <div class="col-xs-1">\n        <button type="button" class="close parameter hidden" title="Remove parameter">\n            <span>&times;</span>\n        </button>\n    </div>\n</div>'},App.Templates.editUMLClassParamList={template:'<div class="row">\n    <div class="col-xs-12">\n        <label class="control-label">Parameters</label>\n    </div>\n</div>\n{{#parameters}}\n    {{{.}}}\n{{/parameters}}\n<div class="row">\n    <div class="col-xs-12">\n        <button type="button" class="btn btn-primary btn-sm add parameter">Add parameter</button>\n    </div>\n</div>'},App.Templates.editUMLClassFormRow={template:'<div class="form-group">\n  <div class="row padded">\n      <label for="{{id}}" class="col-xs-2 control-label">{{name}}</label>\n      <div class="col-xs-8">\n          <input type="text" id="{{id}}" class="form-control name" placeholder="Name" value="{{name}}" />\n      </div>\n      <div class="col-xs-1">\n          <button type="button" class="close property hidden" title="Remove property">\n              <span>&times;</span>\n          </button>\n      </div>\n  </div>\n  <div class="row padded">\n      <div class="col-xs-8 col-xs-push-2">\n          <input type="text" class="form-control type" placeholder="Type" value="{{type}}" />\n      </div>\n  </div>\n  <div class="row padded">\n      <div class="col-xs-8 col-xs-push-2">\n          {{#select}}\n              <select class="form-control visibility">\n                  <option value="public" {{public}}>+ public</option>\n                  <option value="private" {{private}}>- private</option>\n                  <option value="protected" {{protected}}># protected</option>\n                  <option value="package" {{package}}>~ package</option>\n              </select>\n          {{/select}}\n      </div>\n  </div>\n  {{#paramValue}}\n      <div class="row padded">\n          <div class="col-xs-4 col-xs-push-2">\n              <input type="text" class="form-control default" placeholder="Default value (optional)" value="{{default}}" data-current-value="{{default}}" />\n          </div>\n          <div class="col-xs-4 col-xs-push-2">\n              <div class="input-group">\n                  <span class="input-group-addon">\n                      <input type="checkbox" class="nullCheckbox" {{checked}} />\n                  </span>\n                  <input type="text" class="form-control" readonly value="NULL" />\n              </div>\n          </div>\n      </div>\n  {{/paramValue}}\n  {{#paramList}}\n      <div class="row padded">\n          <div class="col-xs-8 col-xs-push-2">\n              {{! triple mustache = unescaped HTML}}\n              {{{list}}}\n          </div>\n      </div>\n  {{/paramList}}\n</div>',bindEvents:function(t,e){var n;return n=this,this.find("#"+t).blur(function(){var t;return t=$(this),t.parent().siblings("label").text(t.val()),!0}),this.find(".close.hidden.property").click(function(){return confirm("Remove '"+e.name+"'?")&&n.remove(),!0}),this.find(".nullCheckbox").change(function(){var t,e;return t=$(this),e=t.closest(".row").find(".default"),t.is(":checked")?(e.attr("data-current-value",e.val()),e.val("")):e.val(e.attr("data-current-value")),!0}),this.find(".add.parameter").click(function(){return $(this).closest(".row").before(App.Templates.getHTML("editUMLClassParamRow",{name:"",type:"","default":""})),!0}),this.find(".close.hidden.parameter").click(function(){return $(this).closest(".row").remove(),!0}),this}},App.Templates.get=function(){var e,n,s,a,i,r;return a=arguments[0],s=arguments[1],n=3<=arguments.length?t.call(arguments,2):[],null!=(r=App.Templates[a])?(null!=r.template?(e=$(Mustache.to_html(r.template,s)),null!=(i=r.bindEvents)&&i.apply(e,n)):e=$(Mustache.to_html(r,s)),e):null},App.Templates.getHTML=function(){var e,n,s,a,i;return a=arguments[0],n=arguments[1],e=3<=arguments.length?t.call(arguments,2):[],null!=(i=App.Templates[a])?s=null!=i.template?Mustache.to_html(i.template,n):Mustache.to_html(i,n):null},App.Templates.getD3=function(){var e,n,s,a,i,r;return a=arguments[0],n=arguments[1],e=3<=arguments.length?t.call(arguments,2):[],null!=(r=App.Templates[a])?(null!=r.template?(s=$(Mustache.to_html(r.template,n)),s=d3.select(s.get(0)),null!=(i=r.bindEvents)&&i.apply(s,e)):(s=Mustache.to_html(r,n),s=d3.select(s.get(0))),s):null},App.UMLConnectionDataCollector=function(){function t(t){this.editor=t,this.reset(),this.div=App.Templates.get("selectClassesForConnection",null,t),$(document.body).append(this.div)}return t.prototype.createConnection=function(){var t;return new(t=App.Connections[this.data.type._capitalize()])(this.data.source,this.data.target)},t.prototype.reset=function(){return this.data={source:null,target:null,type:null},this},t.prototype.setType=function(t){return this.data.type=t,this._update(),this},t.prototype.toggleData=function(t){var e;if(this.data.source===t)this.data.source=null,e=!1;else if(this.data.target===t)this.data.target=null,e=!1;else if(null==this.data.source)this.data.source=t,e=!0;else{if(null!=this.data.target)throw new Error("Invalid data given or existing data is invalid!");this.data.target=t,e=!0}return this._update(),e},t.prototype._update=function(){return this.div.find(".type").text(this.data.type||"?"),this.div.find(".source").text(this.data.source||"?"),this.div.find(".target").text(this.data.target||"?"),this},t.prototype.show=function(){return this.div.fadeIn(100),this},t.prototype.hide=function(){return this.div.fadeOut(100),this},t}(),App.UMLEditor=function(){function t(){var t,e;e=this,this.graph=new dagreD3.graphlib.Graph({multigraph:!0}),this.svg=null,t=App.Templates.get("navbar",null,this),this.connectionModal=App.Templates.get("chooseConnection",null,this),this.dataCollector=new App.UMLConnectionDataCollector(this),$(document.body).append(t).append(this.connectionModal).append(this.chooseStatus),this.classes=[]}return t.prototype.resetSvg=function(){var t;return t=App.Templates.get("svg"),null!=this.svg?$(this.svg.node()).replaceWith(t):$(document.body).append(t),this.svg=d3.select(t.find("svg.uml").get(0)),this},t.prototype.addClass=function(t){var n,s;if(s=t.name,!(e.call(function(){var t,e,s,a;for(s=this.classes,a=[],t=0,e=s.length;e>t;t++)n=s[t],a.push(n.name);return a}.call(this),s)<0))throw new Error("Class with name '"+t.name+"' already exists!");return this.classes.push(t),this},t.prototype.removeClass=function(t){return t["delete"](),this.classes.remove(t),this},t.prototype.addConnection=function(t){var e;return e=this.getClass(t.source),e.addConnection(t),this},t.prototype.removeConnection=function(){return this},t.prototype.getClass=function(t){var e,n,s,a;for(a=this.classes,n=0,s=a.length;s>n;n++)if(e=a[n],e.name===t)return e;return null},t.prototype.showConnectionModal=function(){return this.connectionModal.modal("show"),this},t.prototype.hideConnectionModal=function(){return this.connectionModal.modal("hide"),this},t.prototype.showClassNamesOnly=function(){var t,e,n,s;for(s=this.classes,e=0,n=s.length;n>e;e++)t=s[e],t.views["class"].showOverlay();return this},t.prototype.showClassData=function(){var t,e,n,s;for(s=this.classes,e=0,n=s.length;n>e;e++)t=s[e],t.views["class"].hideOverlay();return this},t.prototype.draw=function(){var t,e,n,s,a,i,r,o,l,c,p,d,u,h,m,f,v,g,y,b,w,x,C,k,A,_,M,T;for(x=this,this.resetSvg(),this.graph=new dagreD3.graphlib.Graph({multigraph:!0}).setGraph({}),f=this.classes,o=0,p=f.length;p>o;o++)e=f[o],null!=(v=e.views["class"].element)&&v.remove(),e.views["class"].draw(),this.graph.setNode(e.name,{shape:"umlClass",label:"",className:e.name});for(g=this.classes,l=0,d=g.length;d>l;l++)for(e=g[l],y=e.outConnections,c=0,u=y.length;u>c;c++)n=y[c],C=n.source,A=n.target,_=n.getType(),this.graph.setEdge(C,A,{arrowhead:_},_+"_from_"+C+"_to_"+A);for(k=this.svg,r=k.select(".zoomer"),T=d3.behavior.zoom().on("zoom",function(){return r.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),!0}),k.call(T),w=new dagreD3.render,w.shapes().umlClass=function(t,n,s){var a,i,r,o;return e=x.getClass(s.className),a=e.views["class"].element,n=a.node().getBBox(),o=n.width,i=n.height,r=[{x:0,y:0},{x:o,y:0},{x:o,y:-i},{x:0,y:-i}],a.attr("transform","translate("+.5*-o+", "+.5*-i+")"),s.intersect=function(t){return dagreD3.intersect.polygon(s,r,t)},t.append(function(){return a.node()}),a},b=Object.keys(App.Connections).without("UMLConnection"),m=0,h=b.length;h>m;m++)s=b[m],w.arrows()[s]=App.Connections[s].getArrowhead();return w(r,this.graph),t=k.node().getBBox(),M=t.width,a=t.height,i=1,T.translate([(M-this.graph.graph().width*i)/2,20]).scale(i).event(k)},t.prototype.serialize=function(){var t;return function(){var e,n,s,a;for(s=this.classes,a=[],e=0,n=s.length;n>e;e++)t=s[e],a.push(t.serialize());return a}.call(this)},t.prototype.deserialize=function(t){var e,n,s;for(this.classes=[],n=0,s=t.length;s>n;n++)e=t[n],this.classes.push(new App.UMLClass(this,e.name,e.attributes,e.methods,{isAbstract:e.isAbstract,isInterface:e.isInterface,outConnections:e.outConnections}));return this},t.prototype.toJSON=function(){return JSON.stringify(this.serialize())},t.prototype.fromJSON=function(t){return this.deserialize(JSON.parse(t))},t}(),App.AbstractView=function(){function t(t){this.model=t}return t.appendDataToSVG=function(t,e){var n,s,a,i,r,o,l;a=t.append(e.tag);for(n in e)l=e[n],"tag"!==n&&"children"!==n&&("class"===n&&(n="classed"),"classed"!==n?("function"==typeof a[n]?a[n](l):void 0)||a.attr(n,l):a.classed(l,!0));if(null!=e.children)for(o=e.children,i=0,r=o.length;r>i;i++)s=o[i],this.appendDataToSVG(a,s);return t},t.prototype.draw=function(){return this},t.prototype.redraw=function(t){return this},t}(),App.UMLClass=function(){function t(t,e,n,s,a){var i,r,o,l,c,p;for(null==a&&(a={}),r=0,l=n.length;l>r;r++)i=n[r],i.visibility||(i.visibility="public");for(o=0,c=s.length;c>o;o++)p=s[o],p.visibility||(p.visibility="public"),p.parameters||(p.parameters=[]);this.editor=t,this.name=e,this.attributes=n,this.methods=s,this.isAbstract=a.isAbstract||!1,this.isInterface=a.isInterface||!1,this.outConnections=a.outConnections||[],this.views={"class":new App.UMLClassView(this),edit:new App.UMLClassEditView(this)},Object.defineProperty(this.views,"all",{enumerable:!1,writable:!1,value:["class","edit"]})}return t.prototype.checkConnection=function(t){var e,n,s,a,i,r,o,l,c;for(n=t.getId(),o=this.outConnections,s=0,i=o.length;i>s;s++)if(e=o[s],e.getId()===n)throw new Error("Connection of that type already exists for class '"+this.name+"'");if(c=t.getType(),"generalization"===c||"realization"===c)for(l=this.editor.getClass(t.target).outConnections,a=0,r=l.length;r>a;a++)if(e=l[a],c=e.getType(),("generalization"===c||"realization"===c)&&e.target===this.name)throw new Error("Cyclic generalization or realization detected!");return this},t.prototype.addConnection=function(t){var e,n;try{this.checkConnection(t),this.outConnections.push(t)}catch(n){e=n}return this},t.prototype.drawAll=function(){var t,e,n;e=this.views;for(t in e)n=e[t],n.draw();return this},t.prototype.update=function(t,e,n,s){var a,i,r;for(null==s&&(s=this.views.all),null!=t&&(this.attributes=t),null!=e&&(this.methods=e),this.isAbstract=n.isAbstract,this.isInterface=n.isInterface,a=0,i=s.length;i>a;a++)r=s[a],this.views[r].redraw();return this},t.prototype["delete"]=function(){var t,e,n;e=this.views;for(t in e)n=e[t],n["delete"]();return null},t.prototype.enterEditMode=function(){return this.views.edit.show(),!0},t.prototype.exitEditMode=function(){return this.views.edit.hide(),!0},t.prototype.serialize=function(){return{name:this.name,attributes:this.attributes,methods:this.methods,isAbstract:this.isAbstract,isInterface:this.isInterface,outConnections:this.outConnections}},t.prototype.deserialize=function(t){return this.name=t.name,this.attributes=t.attributes,this.methods=t.methods,this.isAbstract=t.isAbstract,this.isInterface=t.isInterface,this.outConnections=t.outConnections,this},t}(),App.UMLClassView=function(t){function e(t){e.__super__.constructor.call(this,t),this.element=null,this.id=this._getId(),this.settings={showVisibility:!0,showTypes:!0}}var s;return n(e,t),s=null,e.prototype["delete"]=function(){return this.element.remove(),null},e.prototype._calculateWidth=function(t,e,n,a){var i,r,o,l,c,p,d,u,h;for(null==e&&(e=""),null==n&&(n=""),null==a&&(a="text"),u={position:"absolute",visibility:"hidden"},null==s&&(s=$("<div id='textWidthDummy' />"),$(document.body).append(s)),s.css(u),null!=a&&s.addClass(a),p=0,h=0,s.text(t),(h=s.width())>p&&(p=h),r=0,l=e.length;l>r;r++)i=e[r],s.text(i),(h=s.width())>p&&(p=h);for(o=0,c=n.length;c>o;o++)d=n[o],s.text(d),(h=s.width())>p&&(p=h);return p+10},e.prototype.adjustSize=function(){return this},e.prototype._getId=function(){return this.model.name._idSafe()._idUnique()},e.prototype._createElements=function(t){var e;return e={tag:"g","class":"uml class",id:this.id,children:[{tag:"g","class":"name part",children:[{tag:"rect","class":"rect"},{tag:"text","class":"text",y:"1em",children:[{tag:"tspan","class":"keywords"},{tag:"tspan","font-weight":"bold","class":"name",dy:"1.2em"},{tag:"tspan","class":"properties",dy:"1.2em"}]},{tag:"text","class":"edit","font-family":"'Glyphicons Halflings'","font-size":"13px",html:"✏",y:16}]},{tag:"g","class":"attributes part",children:[{tag:"rect","class":"rect"},{tag:"text","class":"text",y:"1em"}]},{tag:"g","class":"methods part",children:[{tag:"rect","class":"rect"},{tag:"text","class":"text",y:"1em"}]},{tag:"g","class":"overlayWrapper",children:[{tag:"rect","class":"overlay"},{tag:"text","class":"text",y:"1em"}]}]},t=App.AbstractView.appendDataToSVG(t,e),t.select("#"+this.id)},e.prototype._bindEvents=function(){var t,e,n;return n=this,t=this.element,this.element.select(".edit").on("click",function(){return n.model.enterEditMode(),!0}),e=this.element.select(".overlayWrapper"),e.on("click",function(){var t;return t=n.model.editor.dataCollector.toggleData(e.select(".text").text()),e.classed("selected",t),!0}),this},e.prototype._paramsToString=function(t){var e,n,s,a,i;if(!t||0===t.length)return"";for(a=[],e=0,n=t.length;n>e;e++)s=t[e],i=null!=s.type?": "+s.type:"",a.push(""+s.name+i);return a.join(", ")},e.prototype._attributeToString=function(t){var e,n;return n=t.visibility||"public",e=null!=t.type?": "+t.type:"",(this._visibilityToString(n)+" "+t.name+e).trim()},e.prototype._methodToString=function(t){var e;return null!=t.name?(e=null!=t.type?": "+t.type:"",(this._visibilityToString(t.visibility)+" "+t.name+"("+this._paramsToString(t.parameters)+")"+e).trim()):")"===t.last?"+ "+t:"+ "+t+"()"},e.prototype._visibilityToString=function(t){var e;return e={"public":"+","protected":"#","package":"~","private":"-"},
e[t.toLowerCase()]},e.prototype.showOverlay=function(){return this.element.select(".overlayWrapper").style("display","block"),this},e.prototype.hideOverlay=function(){return this.element.select(".overlayWrapper").style("display","none"),this},e.prototype.draw=function(t,e){var n,s,a,i,r,o,l,c,p,d,u,h,m;return this.element=this._createElements(this.model.editor.svg),d=function(){var t,e,s,a;for(s=this.model.attributes,a=[],t=0,e=s.length;e>t;t++)n=s[t],a.push(this._attributeToString(n));return a}.call(this),u=function(){var t,e,n,s;for(n=this.model.methods,s=[],t=0,e=n.length;e>t;t++)l=n[t],s.push(this._methodToString(l));return s}.call(this),c=this.model.name,m=this._calculateWidth(c,d,u),h=0,r=18,o=3,p={left:4,right:0},m+=p.left+p.right,e=0,i=this.model.isInterface,a=this.model.isAbstract,s=3*r,h+=s,this.element.selectAll(".part .rect").attr("width",m),this.element.select(".name .rect").attr("height",s),i&&this.element.select(".name .text .keywords").text("<<interface>>").attr("x",(m-this._calculateWidth("<<interface>>"))/2),this.element.select(".name .text .name").text(c).attr("x",(m-this._calculateWidth(c))/2),a&&this.element.select(".name .text .properties").text("{abstract}").attr("x",(m-this._calculateWidth("{abstract}"))/2),this.element.select(".name .edit").attr("x",m-19),e+=s,s=this.model.attributes.length*(r+o),h+=s,this.element.select(".attributes").attr("transform","translate(0, "+e+")"),this.element.select(".attributes .rect").attr("height",s),this.element.select(".attributes .text").selectAll("tspan").data(function(){var t,e,s;for(s=[],t=0,e=d.length;e>t;t++)n=d[t],s.push({text:n});return s}()).enter().append("tspan").text(function(t){return t.text}).attr("x",p.left).attr("dy",function(t,e){return e>0?r+o:0}),e+=s,s=this.model.methods.length*(r+o),h+=s,this.element.select(".methods").attr("transform","translate(0, "+e+")"),this.element.select(".methods .rect").attr("height",s),this.element.select(".methods .text").selectAll("tspan").data(function(){var t,e,n;for(n=[],t=0,e=u.length;e>t;t++)l=u[t],n.push({text:l});return n}()).enter().append("tspan").text(function(t){return t.text}).attr("x",p.left).attr("dy",function(t,e){return e>0?r+o:0}),this.element.select(".overlay").attr("width",m).attr("height",h),this.element.select(".overlayWrapper .text").text(c).attr("x",(m-this._calculateWidth(c))/2).attr("y",h/2),this._bindEvents(),this},e}(App.AbstractView),App.UMLClassEditView=function(t){function e(t){e.__super__.constructor.call(this,t),this.div=App.Templates.get("editUMLClass",{className:this.model.name,isAbstract:this.model.isAbstract,isInterface:this.model.isInterface},this),this.draw(),$(document.body).append(this.div),this.hide()}return n(e,t),e.prototype["delete"]=function(){return this.div.remove(),null},e.prototype._getInput=function(){var t,e,n;return e={},t=[],n=[],e.isAbstract=this.div.find(".general .abstractCheckbox").prop("checked"),e.isInterface=this.div.find(".general .interfaceCheckbox").prop("checked"),this.div.find(".attributes .form-group").each(function(e,n){var s;return s=$(this),t.push({name:s.find(".name").val(),type:s.find(".type").val(),visibility:s.find(".visibility").val(),"default":s.find(".nullCheckbox").prop("checked")?null:s.find(".default").val()}),!0}),this.div.find(".methods .form-group").each(function(){var t,e;return t=$(this),e=[],t.find(".row.parameter").each(function(){var t;return t=$(this),e.push({name:t.find(".name").val(),type:t.find(".type").val(),"default":t.find(".nullCheckbox").prop("checked")?null:t.find(".default").val()}),!0}),n.push({name:t.find(".name").val(),type:t.find(".type").val(),visibility:t.find(".visibility").val(),parameters:e}),!0}),{generalOptions:e,attributes:t,methods:n}},e.prototype._createParamRow=function(t){return App.Templates.getHTML("editUMLClassParamRow",{name:t.name,type:t.type,"default":t["default"]||""})},e.prototype._createParamList=function(t){var e;return App.Templates.getHTML("editUMLClassParamList",{parameters:function(){var n,s,a,i;for(a=t.parameters||[],i=[],n=0,s=a.length;s>n;n++)e=a[n],i.push(App.Templates.getHTML("editUMLClassParamRow",e));return i}()})},e.prototype._createFormRow=function(t,e){var n,s,a,i;return null==e&&(e=!0),i=this,n=("id_"+this.model.name._idSafe()+"_"+t.name._idSafe())._idUnique(),e?a={"default":t["default"]||"",checked:null!=t["default"]?"":"checked"}:s={list:this._createParamList(t)},App.Templates.get("editUMLClassFormRow",{id:n,name:t.name,type:t.type,"default":t["default"]||"",isAttribute:e,select:{"public":"public"===t.visibility?"selected":"","private":"private"===t.visibility?"selected":"","protected":"protected"===t.visibility?"selected":"","package":"package"===t.visibility?"selected":""},paramValue:a,paramList:s},n,t)},e.prototype.draw=function(){var t,e,n,s,a,i,r,o,l;for(this.div.find(".modal-title .className").text(this.model.name),this.div.find(".general .abstractCheckbox").prop("checked",this.model.isAbstract),this.div.find(".general .interfaceCheckbox").prop("checked",this.model.isInterface),e=this.div.find(".modal-body .attributes form").empty(),o=this.model.attributes,n=0,a=o.length;a>n;n++)t=o[n],e.append(this._createFormRow(t,!0));for(e=this.div.find(".modal-body .methods form").empty(),l=this.model.methods,s=0,i=l.length;i>s;s++)r=l[s],e.append(this._createFormRow(r,!1));return this},e.prototype.redraw=function(){return this.draw()},e.prototype.show=function(){return this.div.modal("show"),this},e.prototype.hide=function(){return this.div.modal("hide"),this},e}(App.AbstractView),App.UMLMultiplicity=function(){function t(t,e){null==t&&(t=1/0),null==e&&(e=1/0),this.min=t,this.max=e}return t.prototype.valToStr=function(t){return t===1/0?"*":""+t},t.prototype.toString=function(){return this.min!==this.max?this.valToStr(this.min)+".."+this.valToStr(this.max):""+this.valToStr(this.min)},t}(),App.Connections.UMLConnection=function(){function t(t,e,n,s){this.source=t,this.target=e,this.multiplicities={source:n||new App.UMLMultiplicity,target:s||new App.UMLMultiplicity}}return t.prototype.getId=function(){return this.constructor.name+"-"+this.source+"-"+this.target},t.prototype.getType=function(){return this.constructor.name},t.getArrowhead=function(){throw new Error("Implment me!")},t}(),App.Connections.Generalization=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.getArrowhead=function(){return function(t,e,n,s){var a,i;return a=t.append("marker").attr("id",e).attr("viewBox","0 0 10 15").attr("refX",11).attr("refY",7.5).attr("markerUnits","strokeWidth").attr("markerWidth",12).attr("markerHeight",15).attr("orient","auto"),i=a.append("path").attr("d","M 0 0 L 10 7.5 L 0 15 z").style("stroke-width",1).style("fill","#fff").style("stroke","#000"),dagreD3.util.applyStyle(i,n[s+"Style"]),t}},e}(App.Connections.UMLConnection),App.Connections.Realization=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.getArrowhead=function(){return function(t,e,n,s){var a,i;return a=t.append("marker").attr("id",e).attr("viewBox","0 0 10 15").attr("refX",11).attr("refY",7.5).attr("markerUnits","strokeWidth").attr("markerWidth",12).attr("markerHeight",15).attr("orient","auto"),i=a.append("path").attr("d","M 0 0 L 10 7.5 L 0 15 z").style("stroke-width",1).style("fill","#fff").style("stroke","#000"),d3.select(n.elem).select("path").style("stroke-dasharray","5, 5"),dagreD3.util.applyStyle(i,n[s+"Style"]),t}},e}(App.Connections.UMLConnection),App.Connections.Aggregation=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.getArrowhead=function(){return function(t,e,n,s){var a,i;return a=t.append("marker").attr("id",e).attr("viewBox","0 0 20 15").attr("refX",21).attr("refY",7.5).attr("markerUnits","strokeWidth").attr("markerWidth",12).attr("markerHeight",15).attr("orient","auto"),i=a.append("path").attr("d","M 10 0 L 20 7.5 L 10 15 L 0 7.5 z").style("stroke-width",1).style("fill","#fff").style("stroke","#000"),dagreD3.util.applyStyle(i,n[s+"Style"]),t}},e}(App.Connections.UMLConnection),App.Connections.Association=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.getArrowhead=function(){return function(t,e,n,s){}},e}(App.Connections.UMLConnection),App.Connections.Composition=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.getArrowhead=function(){return function(t,e,n,s){var a,i;return a=t.append("marker").attr("id",e).attr("viewBox","0 0 20 15").attr("refX",21).attr("refY",7.5).attr("markerUnits","strokeWidth").attr("markerWidth",12).attr("markerHeight",15).attr("orient","auto"),i=a.append("path").attr("d","M 10 0 L 20 7.5 L 10 15 L 0 7.5 z").style("stroke-width",1).style("fill","#000").style("stroke","#000"),dagreD3.util.applyStyle(i,n[s+"Style"]),t}},e}(App.Connections.UMLConnection)}).call(this);