// Generated by CoffeeScript 1.10.0
(function() {
  var calculateHeight, calculateWidth, stringifyAttribute, stringifyMethod, stringifyParameters, stringifyVisibility, textWidthDummy, uml;

  window.DEBUG = true;

  window.App = {
    Configurators: {}
  };

  uml = joint.shapes.uml;

  stringifyVisibility = function(visibilty) {
    var mapper;
    if (visibilty == null) {
      visibilty = "public";
    }
    mapper = {
      "public": "+",
      "protected": "#",
      "package": "~",
      "private": "-"
    };
    return mapper[visibilty.toLowerCase()];
  };

  stringifyParameters = function(parameters) {
    var param;
    if (!parameters || parameters.length === 0) {
      return "";
    }
    return ((function() {
      var i, len, results;
      results = [];
      for (i = 0, len = parameters.length; i < len; i++) {
        param = parameters[i];
        results.push(param.name + ": " + param.type);
      }
      return results;
    })()).join(", ");
  };

  stringifyAttribute = function(attribute) {
    return ((stringifyVisibility(attribute.visibilty)) + " " + attribute.name + ": " + attribute.type).trim();
  };

  stringifyMethod = function(method) {
    var suffix;
    if (method.type != null) {
      suffix = ": " + method.type;
    } else {
      suffix = "";
    }
    return ((stringifyVisibility(method.visibilty)) + " " + method.name + "(" + (stringifyParameters(method.parameters)) + ")" + suffix).trim();
  };

  calculateHeight = function(name, attributes, methods) {
    return (attributes.length + methods.length) * 14 + 35;
  };

  textWidthDummy = null;

  calculateWidth = function(name, stringifiedAttributes, stringifiedMethods, style) {
    var attribute, i, j, len, len1, maxWidth, method, width;
    if (style == null) {
      style = {
        "font-size": "12px",
        "font-family": "Times New Roman"
      };
    }
    style["position"] = "absolute";
    style["visibility"] = "hidden";
    if (textWidthDummy == null) {
      textWidthDummy = $("<div />");
      $(document.body).append(textWidthDummy);
    }
    textWidthDummy.css(style);
    maxWidth = 0;
    width = 0;
    textWidthDummy.text(name);
    if ((width = textWidthDummy.width()) > maxWidth) {
      maxWidth = width;
    }
    for (i = 0, len = stringifiedAttributes.length; i < len; i++) {
      attribute = stringifiedAttributes[i];
      textWidthDummy.text(attribute);
      if ((width = textWidthDummy.width()) > maxWidth) {
        maxWidth = width;
      }
    }
    for (j = 0, len1 = stringifiedMethods.length; j < len1; j++) {
      method = stringifiedMethods[j];
      textWidthDummy.text(method);
      if ((width = textWidthDummy.width()) > maxWidth) {
        maxWidth = width;
      }
    }
    return maxWidth + 10;
  };

  App.ShapeFactory = {
    Model: {
      "new": function(data, layout) {
        var attribute, attributes, h, method, methods, name, object, stringifiedAttributes, stringifiedMethods, w, x, y;
        name = data.name + " (Model)";
        attributes = data.attributes || [];
        methods = data.methods || [];
        stringifiedAttributes = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = attributes.length; i < len; i++) {
            attribute = attributes[i];
            results.push(stringifyAttribute(attribute));
          }
          return results;
        })();
        stringifiedMethods = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = methods.length; i < len; i++) {
            method = methods[i];
            results.push(stringifyMethod(method));
          }
          return results;
        })();
        x = layout.x || 10;
        y = layout.y || 10;
        w = layout.width || calculateWidth(name, stringifiedAttributes, stringifiedMethods);
        h = layout.height || calculateHeight(name, attributes, methods);
        object = new uml.Class({
          position: {
            x: x,
            y: y
          },
          size: {
            width: w,
            height: h
          },
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods
        });
        object.mvc = {
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods,
          type: "model"
        };
        return object;
      }
    },
    Controller: {
      "new": function(data, layout) {
        var attribute, attributes, h, method, methods, name, object, stringifiedAttributes, stringifiedMethods, w, x, y;
        name = data.name + " (Controller)";
        attributes = data.attributes || [];
        methods = data.methods || [];
        stringifiedAttributes = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = attributes.length; i < len; i++) {
            attribute = attributes[i];
            results.push(stringifyAttribute(attribute));
          }
          return results;
        })();
        stringifiedMethods = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = methods.length; i < len; i++) {
            method = methods[i];
            results.push(stringifyMethod(method));
          }
          return results;
        })();
        x = layout.x || 10;
        y = layout.y || 10;
        w = layout.width || calculateWidth(name, stringifiedAttributes, stringifiedMethods);
        h = layout.height || calculateHeight(name, attributes, methods);
        object = new uml.Class({
          position: {
            x: x,
            y: y
          },
          size: {
            width: w,
            height: h
          },
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods
        });
        object.mvc = {
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods,
          type: "controller"
        };
        return object;
      }
    },
    View: {
      "new": function(data, layout) {
        var attribute, attributes, h, method, methods, name, object, stringifiedAttributes, stringifiedMethods, w, x, y;
        name = data.name + " (View)";
        attributes = data.attributes || [];
        methods = data.methods || [];
        stringifiedAttributes = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = attributes.length; i < len; i++) {
            attribute = attributes[i];
            results.push(stringifyAttribute(attribute));
          }
          return results;
        })();
        stringifiedMethods = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = methods.length; i < len; i++) {
            method = methods[i];
            results.push(stringifyMethod(method));
          }
          return results;
        })();
        x = layout.x || 10;
        y = layout.y || 10;
        w = layout.width || calculateWidth(name, stringifiedAttributes, stringifiedMethods);
        h = layout.height || calculateHeight(name, attributes, methods);
        object = new uml.Class({
          position: {
            x: x,
            y: y
          },
          size: {
            width: w,
            height: h
          },
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods,
          type: "view"
        });
        object.mvc = {
          name: name,
          attributes: stringifiedAttributes,
          methods: stringifiedMethods,
          type: "view"
        };
        return object;
      }
    }
  };

  uml = joint.shapes.uml;

  App.LinkFactory = {
    "new": function(type, source, target) {
      if (source.mvc.type === "controller" || target.mvc.type === "controller") {
        return new uml[type]({
          source: {
            id: source.id
          },
          target: {
            id: target.id
          }
        });
      }
      throw new Error("LinkFactory.new: Cannot connect a " + source.mvc.type + " to a " + target.mvc.type);
    }
  };

}).call(this);
